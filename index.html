<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokedex Amarilla</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div class="search-container">
        <input type="text" id="pokemonInput" placeholder="Nombre o número del Pokémon...">
        <button id="btnBuscar">Buscar</button>
    </div>

    <div class="card" id="card" style="display:none;">
        <img id="pokemonImg" class="pokemon-img">

        <h1 id="pokemonName"></h1>

        <div id="pokemonType"></div>

        <div class="weakness-box">
            <p class="label">Debilidades</p>
            <div id="Debilidades" class="Debilidades-lista"></div>
        </div>

        <div class="info-row">
            <div>
                <p class="label">Altura</p>
                <p id="height"></p>
            </div>
            <div>
                <p class="label">Peso</p>
                <p id="weight"></p>
            </div>
            <div>
                <p class="label">Categoría</p>
                <p id="category"></p>
            </div>
            <div>
                <p class="label">Habilidad</p>
                <p id="ability"></p>
            </div>
        </div>

        <p id="description" class="descripcion"></p>

        <div id="stats"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script>
document.getElementById("btnBuscar").addEventListener("click", obtenerPokemon);

        // COLORES DE CADA TIPO PARA EL DEGRADADO
        const typeColors = {
            normal: "#A8A878",
            fire: "#F08030",
            water: "#6890F0",
            electric: "#F8D030",
            grass: "#78C850",
            ice: "#98D8D8",
            fighting: "#C03028",
            poison: "#A040A0",
            ground: "#E0C068",
            flying: "#A890F0",
            psychic: "#F85888",
            bug: "#A8B820",
            rock: "#B8A038",
            ghost: "#705898",
            dragon: "#7038F8",
            dark: "#705848",
            steel: "#B8B8D0",
            fairy: "#EE99AC"
        };

        // Función para aplicar el degradado de los TIPOS DEL POKÉMON (al fondo de la CARD)
        function aplicarDegradado(types) {
            const card = document.querySelector(".card");

            const colors = types.map(t => typeColors[t]);

            if (colors.length === 1) {
                // Un solo tipo → degradado suave
                card.style.background = `linear-gradient(135deg, ${colors[0]} 0%, ${colors[0]}88 100%)`;
                return;
            }

            // Más de 1 tipo → distribuirlos proporcionalmente
            let gradient = "linear-gradient(135deg, ";

            colors.forEach((color, index) => {
                const pct = Math.round((index / (colors.length - 1)) * 100);
                gradient += `${color} ${pct}%, `;
            });

            gradient = gradient.slice(0, -2) + ")";
            card.style.background = gradient;
        }


        // ❌ ELIMINAMOS LA FUNCIÓN aplicarDegradadoDebilidades (ya no la necesitamos)


        // Diccionario de traducciones para nombres de estadísticas (stats)
        const statTraducciones = {
            'hp': 'PS',
            'attack': 'Ataque',
            'defense': 'Defensa',
            'special-attack': 'Ataque Especial',
            'special-defense': 'Defensa Especial',
            'speed': 'Velocidad'
        };

        // Función de ayuda para obtener traducciones de nombres de objetos (Tipos, Habilidades, Stats)
        async function obtenerTraduccion(url, tipo = 'nombre') {
            try {
                const res = await axios.get(url);

                if (tipo === 'nombre') {
                    const nombreEnEspanol = res.data.names.find(n => n.language.name === 'es');
                    return nombreEnEspanol ? nombreEnEspanol.name : res.data.name;

                } else if (tipo === 'descripcion') {
                    let texto = res.data.flavor_text_entries.find(t => t.language.name === 'es');
                    if (!texto) texto = res.data.flavor_text_entries.find(t => t.language.name === 'en');
                    return texto ? texto.flavor_text.replace(/\n/g, " ") : "Sin descripción.";

                } else if (tipo === 'categoria') {
                    const categoriaEs = res.data.genera.find(g => g.language.name === 'es');
                    return categoriaEs ? categoriaEs.genus : "Sin categoría.";
                }

                return res.data.name;
            } catch (e) {
                console.error("Error al obtener traducción:", e);
                return url.split('/').pop();
            }
        }

        async function obtenerPokemon() {
            let poke = document.getElementById("pokemonInput").value.toLowerCase();
            if (!poke) return;

            try {
                const res = await axios.get(`https://pokeapi.co/api/v2/pokemon/${poke}`);
                const species = await axios.get(res.data.species.url);

                document.getElementById("card").style.display = "block";

                // Nombre
                document.getElementById("pokemonName").textContent =
                    res.data.name.charAt(0).toUpperCase() + res.data.name.slice(1);

                // Imagen
                document.getElementById("pokemonImg").src =
                    res.data.sprites.other["official-artwork"].front_default;

                // Tipos + degradado según los tipos (Fondo de la Card)
                let typeHTML = "";
                const typesRAW = []; // ← guardamos los tipos originales (en inglés) para el degradado

                for (let t of res.data.types) {
                    const nombreTipoEs = await obtenerTraduccion(t.type.url, 'nombre');

                    typesRAW.push(t.type.name); // ← inglés

                    // La etiqueta del tipo SÍ mantiene el color de fondo para la consistencia
                    typeHTML += `<span class="type-tag type-${t.type.name}">${nombreTipoEs}</span>`;
                }

                document.getElementById("pokemonType").innerHTML = typeHTML;

                // Aplicar degradado al fondo de la Card
                aplicarDegradado(typesRAW);

                // Debilidades
                let Debilidades = new Set();
                const weaknessesRAW = []; // Almacena los tipos en inglés para el degradado de la caja

                for (let t of res.data.types) {
                    const typeData = await axios.get(t.type.url);
                    for (let w of typeData.data.damage_relations.double_damage_from) {
                        // Evita duplicados
                        if (!Debilidades.has(w.name)) {
                            Debilidades.add(w.name);
                            weaknessesRAW.push(w.name);
                        }
                    }
                }

                let weakHTML = "";
                for (let w of Debilidades) {
                    const nombreWeakEs = await obtenerTraduccion(
                        `https://pokeapi.co/api/v2/type/${w}`,
                        'nombre'
                    );

                    // IMPORTANTE: La etiqueta de debilidad YA NO lleva la clase de color de tipo (type-${w})
                    weakHTML += `<span class="weakness-tag">${nombreWeakEs}</span>`;
                }

                document.getElementById("Debilidades").innerHTML = weakHTML;

                // ❌ ELIMINAMOS LA LLAMADA A aplicarDegradadoDebilidades(weaknessesRAW);

                // Altura / Peso
                document.getElementById("height").textContent = (res.data.height / 10) + " m";
                document.getElementById("weight").textContent = (res.data.weight / 10) + " kg";

                // Categoría
                const categoryEs = await obtenerTraduccion(res.data.species.url, 'categoria');
                document.getElementById("category").textContent = categoryEs;

                // Habilidad
                const abilityURL = res.data.abilities[0].ability.url;
                const abilityNameEs = await obtenerTraduccion(abilityURL, 'nombre');
                document.getElementById("ability").textContent = abilityNameEs;

                // Descripción
                const descriptionEs = await obtenerTraduccion(res.data.species.url, 'descripcion');
                document.getElementById("description").textContent = descriptionEs;

                // Stats
                let statsHTML = "";
                for (let s of res.data.stats) {
                    const statNameOriginal = s.stat.name;
                    const statNameEs =
                        statTraducciones[statNameOriginal] ||
                        statNameOriginal.charAt(0).toUpperCase() + statNameOriginal.slice(1);

                    statsHTML += `
                    <p>${statNameEs}: ${s.base_stat}/255</p>
                    <div class="stat-bar">
                        <div class="stat-fill" style="width:${(s.base_stat / 255) * 100}%"></div>
                    </div>
                `;
                }

                document.getElementById("stats").innerHTML = statsHTML;

            } catch (err) {
                console.error(err);
                alert("Pokémon no encontrado");
                document.getElementById("card").style.display = "none";
            }
        }
    </script>


</body>

</html>